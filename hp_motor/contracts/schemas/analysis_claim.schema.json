{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://hp-engine.local/schemas/analysis_claim.schema.json",
  "title": "HP Engine Analysis Claim",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "claim_id",
    "scope",
    "summary",
    "claims",
    "provenance",
    "created_at"
  ],
  "properties": {
    "claim_id": {
      "type": "string",
      "description": "Unique identifier for the claim bundle (report section). Suggested: ULID."
    },
    "scope": {
      "type": "string",
      "enum": [
        "prematch_analysis",
        "postmatch_analysis",
        "individual_analysis",
        "team_tactical_analysis",
        "seasonal_tournament_analysis",
        "squad_engineering_analysis",
        "general_analysis",
        "video_analysis",
        "body_orientation_analysis",
        "positional_analysis"
      ]
    },
    "summary": {
      "type": "string",
      "minLength": 3
    },
    "claims": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "text",
          "dimension",
          "evidence",
          "confidence",
          "falsification",
          "status"
        ],
        "properties": {
          "text": {
            "type": "string",
            "minLength": 5
          },
          "dimension": {
            "type": "string",
            "enum": [
              "tactical",
              "technical",
              "physical",
              "psychological",
              "neurological",
              "somatotype",
              "environmental",
              "contextual",
              "intent",
              "effort",
              "struggle",
              "talent",
              "communication",
              "positional",
              "set_piece",
              "transition"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "candidate",
              "confirmed",
              "rejected"
            ]
          },
          "method": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "type"
            ],
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "deterministic",
                  "stat_model",
                  "ml_model",
                  "heuristic",
                  "human_annotation"
                ]
              },
              "metric_ids": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "parameters": {
                "type": "object",
                "additionalProperties": true
              },
              "model_ref": {
                "type": "string"
              }
            }
          },
          "evidence": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "evidence_id",
                "evidence_type",
                "source",
                "fields_used"
              ],
              "properties": {
                "evidence_id": {
                  "type": "string"
                },
                "evidence_type": {
                  "type": "string",
                  "enum": [
                    "primary_raw",
                    "primary_derived",
                    "secondary_reference",
                    "video_support",
                    "annotation"
                  ]
                },
                "source": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": [
                    "source_type",
                    "source_name"
                  ],
                  "properties": {
                    "source_type": {
                      "type": "string",
                      "enum": [
                        "csv",
                        "xml",
                        "xlsx",
                        "pdf",
                        "docx",
                        "txt",
                        "video",
                        "api",
                        "manual"
                      ]
                    },
                    "source_name": {
                      "type": "string"
                    },
                    "uri": {
                      "type": "string"
                    },
                    "fingerprint": {
                      "type": "string"
                    }
                  }
                },
                "fields_used": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "string"
                  }
                },
                "time_window": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "match_minute_start": {
                      "type": "number"
                    },
                    "match_minute_end": {
                      "type": "number"
                    },
                    "wallclock_start": {
                      "type": "string"
                    },
                    "wallclock_end": {
                      "type": "string"
                    }
                  }
                },
                "value_excerpt": {
                  "type": "object",
                  "additionalProperties": true
                },
                "uncertainty": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": [
                    "level"
                  ],
                  "properties": {
                    "level": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 3
                    },
                    "notes": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "confidence": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "score",
              "coverage"
            ],
            "properties": {
              "score": {
                "type": "number",
                "minimum": 0.0,
                "maximum": 1.0
              },
              "coverage": {
                "type": "number",
                "minimum": 0.0,
                "maximum": 1.0
              },
              "reason": {
                "type": "string"
              }
            }
          },
          "falsification": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "tests"
            ],
            "properties": {
              "tests": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": [
                    "name",
                    "type",
                    "pass_condition"
                  ],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "unit_check",
                        "schema_check",
                        "counterfactual",
                        "sensitivity",
                        "benchmark",
                        "drift"
                      ]
                    },
                    "pass_condition": {
                      "type": "string"
                    },
                    "result": {
                      "type": "string"
                    },
                    "passed": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "citations": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "ref_id",
                "relation"
              ],
              "properties": {
                "ref_id": {
                  "type": "string"
                },
                "relation": {
                  "type": "string",
                  "enum": [
                    "definition",
                    "method",
                    "benchmark",
                    "context",
                    "limitation"
                  ]
                },
                "locator": {
                  "type": "string"
                }
              }
            }
          },
          "notes": {
            "type": "string"
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "engine_version",
        "run_id"
      ],
      "properties": {
        "engine_version": {
          "type": "string"
        },
        "run_id": {
          "type": "string"
        },
        "environment": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "created_at": {
      "type": "string",
      "description": "ISO-8601 timestamp"
    },
    "updated_at": {
      "type": "string",
      "description": "ISO-8601 timestamp"
    }
  }
}